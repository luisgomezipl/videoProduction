<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Cards</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-6" id="filtercontainer">
        <ul id="filterOptions">
          <li class="active"><a href="#" class="default">Default</a></li>
          <li><a href="#" class="education">Education</a></li>
          <li><a href="#" class="work">Work</a></li>
          <li><a href="#" class="project">Relevant Projects</a></li>
          <li><a href="#" class="web">Web</a></li>
          <li><a href="#" class="joomla">Joomla</a></li>
          <li><a href="#" class="android">Android</a></li>
        </ul>
      </div>

      <div class="col-4">
        <input id="seach-bar" type="text" name="search" placeholder="Key word...">
      </div>
      <div class="col-2">
        <button id="btn" class="button">Search</button>
      </div>
    </div>
    <figure class="snip1336" id="luis-info"></figure>
    <figure class="snip1336" id="emanuel-info"></figure>
    <figure class="snip1336" id="gabriel-info"></figure>
  </div>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src="js/index.js"></script>
  <script>
    var jsonLuis, jsonEmanuel, jsonGabriel;
    var arrayKeys = new Array('experience','education','projects','certifications');

    $(document).ready(function() {
      createPrincipalInformation();
      tagsFunctionality();
      buttonEvent();
    });

    function createPrincipalInformation(){
      $.getJSON("data/luisData.js", function(result){
          jsonLuis = result[0];
          stringHtml ='<img src="../images/background1.png" alt="background1" /><figcaption><img src="'+jsonLuis['photo']+'" alt="profile-photo" class="profile" /><h2>'+jsonLuis['name']+'</h2><h2><span>'+jsonLuis['title']+'</span></h2><p class="card-content" id="luis">'+jsonLuis['brief']+'</p><center>'+validateSocial(jsonLuis['social'])+'<br><a href="personal.html?id=0" class="info">More Info</a></center></figcaption>';
          $('#luis-info').append(stringHtml);
      });
      $.getJSON("data/emanuelData.js", function(result){
          jsonEmanuel = result[0];
          stringHtml ='<img src="../images/background2.png" alt="background2" /><figcaption><img src="'+jsonEmanuel['photo']+'" alt="profile-photo" class="profile" /><h2>'+jsonEmanuel['name']+'</h2><h2><span>'+jsonEmanuel['title']+'</span></h2><p class="card-content" id="emanuel">'+jsonEmanuel['brief']+'</p><center>'+validateSocial(jsonEmanuel['social'])+'<br><a href="personal.html?id=1" class="info">More Info</a></center></figcaption>';
          $('#emanuel-info').append(stringHtml);
      });
      $.getJSON("data/gabrielData.js", function(result){
          jsonGabriel = result[0];
          stringHtml ='<img src="../images/background3.png" alt="background3" /><figcaption><img src="'+jsonGabriel['photo']+'" alt="profile-photo" class="profile" /><h2>'+jsonGabriel['name']+'</h2><h2><span>'+jsonGabriel['title']+'</span></h2><p class="card-content" id="gabriel">'+jsonGabriel['brief']+'</p><center>'+validateSocial(jsonGabriel['social'])+'<br><a href="personal.html?id=2" class="info">More Info</a></center></figcaption>';
          $('#gabriel-info').append(stringHtml);
      });
    }

    function validateSocial(jsonSocial){
      var cont = 0;
      var strHtml = '<br>';
      if(jsonSocial['facebook']!=''){
        strHtml += '<a target="_blank" href="'+jsonSocial['facebook']+'" class="social facebook"><img src="../images/fb.png"/></a>';
        cont++;
      }
      if(jsonSocial['twitter']!=''){
        strHtml += '<a target="_blank" href="'+jsonSocial['twitter']+'" class="social twitter"><img src="../images/twitter.png"/></a>';
        cont++;
      }
      if(jsonSocial['linkedin']!=''){
        strHtml += '<a target="_blank" href="'+jsonSocial['linkedin']+'" class="social linkedin"><img src="../images/in.png"/></a>';
        cont++;
      }
      if(cont>0){
        strHtml += '<br>';
        return strHtml;
      }else{
        return '';
      }
    }

    function tagsFunctionality(){
        $('#filterOptions li a').click(function () {
        // fetch the class of the clicked item
        var ourClass = $(this).attr('class');

        // reset the active class on all the buttons
        $('#filterOptions li').removeClass('active');
        // update the active state on our clicked button
        $(this).parent().addClass('active');

        switch (ourClass) {
          case 'default':
            loadDefautInformation();
            break;
          case 'project':
            searchEstructureInformation('projects');
            break;
          case 'education':
            searchEstructureInformation('education');
            break;
          case 'work':
            searchEstructureInformation('experience');
            break;
          default:
            searchMatchWithTag(ourClass);
            break;
        }
        return false;
      });
    }

    function loadDefautInformation(){
      $('.card-content#luis').text(jsonLuis['brief']);
      $('.card-content#emanuel').text(jsonEmanuel['brief']);
      $('.card-content#gabriel').text(jsonGabriel['brief']);
    }

    function searchEstructureInformation(infoType){
      $('.card-content#luis').html(buildEstructureInformation(jsonLuis[infoType], infoType));
      $('.card-content#emanuel').html(buildEstructureInformation(jsonEmanuel[infoType], infoType));
      $('.card-content#gabriel').html(buildEstructureInformation(jsonGabriel[infoType], infoType));
    }

    function searchMatchWithTag(tag){
        buildHtmlLuisData(arrayKeys, tag);
        buildHtmlEmanuelData(arrayKeys, tag);
        buildHtmlGabrielData(arrayKeys, tag);
    }

    function buildHtmlLuisData(arrayKeys, tag){
      var htmlValue = '';
      $.each(arrayKeys, function(i, key){
        var data = getJsonArrayWithTag(jsonLuis[key], tag);
        if(data.length > 0){
          htmlValue += buildEstructureInformation(data, key);
        }
      });
      if(htmlValue.length > 0){
        $('.card-content#luis').html(htmlValue);
      }else{
        $('.card-content#luis').text('No information found.');
      }
    }

    function buildHtmlEmanuelData(arrayKeys, tag){
      var htmlValue = '';
      $.each(arrayKeys, function(i, key){
        var data = getJsonArrayWithTag(jsonEmanuel[key], tag);
        if(data.length > 0){
          htmlValue += buildEstructureInformation(data, key);
        }
      });
      if(htmlValue.length > 0){
        $('.card-content#emanuel').html(htmlValue);
      }else{
        $('.card-content#emanuel').text('No information found.');
      }
    } 

    function buildHtmlGabrielData(arrayKeys, tag){
      var htmlValue = '';
      $.each(arrayKeys, function(i, key){
        var data = getJsonArrayWithTag(jsonGabriel[key], tag);
        if(data.length > 0){
          htmlValue += buildEstructureInformation(data, key);
        }
      });
      if(htmlValue.length > 0){
        $('.card-content#gabriel').html(htmlValue);
      }else{
        $('.card-content#gabriel').text('No information found.');
      }
    }  

    function getJsonArrayWithTag(jsonArray, tag){
       var resultArray = new Array();
       $.each(jsonArray, function(i, object){
          if(object['tags'].toLowerCase().search(tag) >= 0){
              resultArray.push(object);
          } 
       });
       return resultArray;
    }

    function buttonEvent(){
      $("#btn").click(function(){
        if(jsonLuis == undefined || jsonEmanuel == undefined || jsonGabriel == undefined){
          alert("Error: The data not loaded.");
        }else{
          var inputValue = $("input#seach-bar").val();
          if(inputValue.trim().length > 2){
            searchMatchKeySearch(inputValue.toLowerCase());
          }
        }
      });
    }

    function searchMatchKeySearch(tag){
        buildHtmlLuisDataSearch(arrayKeys, tag);
        buildHtmlEmanuelDataSearch(arrayKeys, tag);
        buildHtmlGabrielDataSearch(arrayKeys, tag);
    }

    function buildHtmlLuisDataSearch(arrayKeys, tagKey){
      var htmlValue = '';
      $.each(arrayKeys, function(i, key){
        var data = getArrayKeyFindedInJsonArray(jsonLuis[key], tagKey);
        if(data.length > 0){
          htmlValue += buildEstructureInformation(data, key);
        }
      });
      if(htmlValue.length > 0){
        $('.card-content#luis').html(htmlValue);
      }else{
        $('.card-content#luis').text('No information found.');
      }
    } 

    function buildHtmlEmanuelDataSearch(arrayKeys, tagKey){
      var htmlValue = '';
      $.each(arrayKeys, function(i, key){
        var data = getArrayKeyFindedInJsonArray(jsonEmanuel[key], tagKey);
        if(data.length > 0){
          htmlValue += buildEstructureInformation(data, key);
        }
      });
      if(htmlValue.length > 0){
        $('.card-content#emanuel').html(htmlValue);
      }else{
        $('.card-content#emanuel').text('No information found.');
      }
    }

    function buildHtmlGabrielDataSearch(arrayKeys, tagKey){
      var htmlValue = '';
      $.each(arrayKeys, function(i, key){
        var data = getArrayKeyFindedInJsonArray(jsonGabriel[key], tagKey);
        if(data.length > 0){
          htmlValue += buildEstructureInformation(data, key);
        }
      });
      if(htmlValue.length > 0){
        $('.card-content#gabriel').html(htmlValue);
      }else{
        $('.card-content#gabriel').text('No information found.');
      }
    }     

    function getArrayKeyFindedInJsonArray(jsonArray, keyText){
       var resultArray = new Array();
       for(var obj in jsonArray){
          if(jsonArray.hasOwnProperty(obj)){
              for(var prop in jsonArray[obj]){
                  if(jsonArray[obj].hasOwnProperty(prop) && 
                    jsonArray[obj][prop].toLowerCase().search(keyText) >= 0){
                      resultArray.push(jsonArray[obj]);
                      break;
                  }
              }
          }
       }
       return resultArray;
    }

    function buildEstructureInformation(jsonInfo, infoType){
      var htmlString = '';
      switch (infoType) {
          case 'projects':
            $.each(jsonInfo, function(i, field){
              htmlString += '<strong>'+field['name']+': </strong><em>'+field['description'].substr(0,150)+'...</em><br>';
            }); 
            break;
          case 'education':
            $.each(jsonInfo, function(i, field){
              htmlString += '<strong>'+field['title']+'</strong> in <em>'+field['place']+'.</em><br>';
            }); 
            break;
          case 'experience':
            $.each(jsonInfo, function(i, field){
              htmlString += '<strong>'+field['job']+'</strong> in <em>'+field['business']+'.</em><br>';
            });
            break;
        }
      return htmlString;
    }

    function readJsonArrayBasic(){
       var jsonData = [{person:"me", age :"30"},{person:"you",age:"25"}];
       for(var obj in jsonData){
          if(jsonData.hasOwnProperty(obj)){
              for(var prop in jsonData[obj]){
                  if(jsonData[obj].hasOwnProperty(prop)){
                      alert(prop + ':' + jsonData[obj][prop]);
                  }
              }
          }
       }
    }
  </script>
</body>

</html>